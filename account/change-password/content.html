<h1>change password</h1>
<h2>update your account password</h2>

<form id="password-form" method="POST">
    <input type="hidden" name="csrf_token" value="<?php echo htmlspecialchars($_SESSION['csrf_token'] ?? '', ENT_QUOTES, 'UTF-8'); ?>">
    
    <h3>new password</h3>
    <input id="textbox" name="new_password" type="password" required minlength="8" maxlength="128">

    <h3>confirm password</h3>
    <input id="textbox" name="confirm_password" type="password" required minlength="8" maxlength="128">
    <br><br>
    <span id="message"></span>

    <br><br><br>
    <button id="form-button" type="submit">change password</button>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('password-form');
    const messageSpan = document.getElementById('message');
    const contentDiv = document.getElementById('content');
    
    // Display any password change message from PHP
    if (contentDiv && contentDiv.getAttribute('data-password-message')) {
        const msg = contentDiv.getAttribute('data-password-message');
        const type = contentDiv.getAttribute('data-message-type');
        if (msg) {
            messageSpan.textContent = msg;
            messageSpan.style.color = type === 'success' ? 'rgb(120, 200, 120)' : 'red';
        }
        contentDiv.removeAttribute('data-password-message');
        contentDiv.removeAttribute('data-message-type');
    }
    
    // Handle form submission
    form.addEventListener('submit', function(e) {
        const newPassword = document.querySelector('input[name="new_password"]').value;
        const confirmPassword = document.querySelector('input[name="confirm_password"]').value;
        messageSpan.textContent = '';
        
        if (newPassword.length < 8) {
            e.preventDefault();
            messageSpan.textContent = 'Password must be at least 8 characters.';
            messageSpan.style.color = 'red';
            return;
        }
        
        if (newPassword !== confirmPassword) {
            e.preventDefault();
            messageSpan.textContent = 'Passwords do not match.';
            messageSpan.style.color = 'red';
            return;
        }
    });
});
</script>