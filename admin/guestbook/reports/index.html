<!DOCTYPE html>
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="/resources/favicon.png"> 
    <title>fridge | guestbook reports</title>
    <meta name="description" content="Authorized Access Only">
</head>

<body>
<div class="container">
<script src="/theme.js"></script>
<button id="change-theme"><i class="fa-solid fa-palette"></i></button>
    <center>
    <h1><a href="/">fridge</a></h1>
    <a href="/microblog">[micro]</a><a href="/blog">blog</a>
    <a href="/about">about</a>
    <a href="/contact">contact</a>
    <a href="/projects">projects</a>
    <a href="/music">music</a>
</center>
<br>
<h3>Report Queue</h3>
<br>
<center>
<div id="reports-root">
    <p>Loading reports…</p>
</div>
</center>

<script>
    (function(){
        const root = document.getElementById('reports-root');
        function esc(s){ return String(s||'').replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])); }
        function renderList(list){
            if(!Array.isArray(list) || list.length===0){ root.innerHTML = '<p>No reports found.</p>'; return; }
            let html = '<table style="width:100%;border-collapse:collapse">';
            html += '<thead><tr><th style="text-align:left;padding:6px;border-bottom:1px solid #333">Time</th><th style="text-align:left;padding:6px;border-bottom:1px solid #333">Reporter</th><th style="text-align:left;padding:6px;border-bottom:1px solid #333">Reported</th><th style="text-align:left;padding:6px;border-bottom:1px solid #333">Reason</th></tr></thead>';
            html += '<tbody>';
            for(const r of list){
                const t = r.time ? esc(r.time) : '';
                const rep = esc(r.reporter || r.reported || '');
                const reported = esc(r.reported || '');
                const reason = esc(r.reason || '');
                html += `<tr><td style="vertical-align:top;padding:6px;border-top:1px solid #222">${t}</td><td style="vertical-align:top;padding:6px;border-top:1px solid #222">${rep}</td><td style="vertical-align:top;padding:6px;border-top:1px solid #222">${reported}</td><td style="vertical-align:top;padding:6px;border-top:1px solid #222">${reason}</td></tr>`;
            }
            html += '</tbody></table>';
            root.innerHTML = html;
        }
        function load(){
            root.innerHTML = '<p>Loading reports…</p>';
            fetch('/guestbook/data/reports.json', {cache:'no-store', credentials:'include'}).then(r => {
                if(!r.ok){ root.innerHTML = '<p>Failed to load reports ('+r.status+')</p>'; return; }
                return r.json();
            }).then(json => {
                renderList(json || []);
            }).catch(err => {
                console.error('failed to load reports', err);
                root.innerHTML = '<p>Failed to load reports (network)</p>';
            });
        }
        load();
    })();
</script>

</div>
</body>
</html>
