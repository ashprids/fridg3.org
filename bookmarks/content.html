<pre id="ascii" style="color:#aacc5b;font-size:12px">                                            
.d8888b   8888b.  888  888  .d88b.  .d8888b 
88K          "88b 888  888 d8P  Y8b 88K     
"Y8888b. .d888888 Y88  88P 88888888 "Y8888b.
     X88 888  888  Y8bd8P  Y8b.          X88
 88888P' "Y888888   Y88P    "Y8888   88888P'
</pre><br><br>

<h1>feed</h1><br>
<div id="bookmarks-feed-list">
	<!-- feed bookmarks will be injected here -->
	you haven't saved any feed posts yet
</div><br><br>
<h1>journal</h1><br>
<div id="bookmarks-journal-list">
	<!-- journal bookmarks will be injected here -->
	you haven't saved any journal posts yet
</div>
<script>
// Show bookmarks for anonymous users from localStorage
if (!window.isLoggedIn || !window.isLoggedIn()) {
	document.addEventListener('DOMContentLoaded', function() {
		var bookmarks = [];
		try {
			var raw = localStorage.getItem('bookmarkedPosts');
			if (raw) bookmarks = JSON.parse(raw);
		} catch (_) {}
		var feedList = document.getElementById('bookmarks-feed-list');
		var journalList = document.getElementById('bookmarks-journal-list');
		if (!feedList || !journalList) return;
		var feedHtml = '';
		var journalHtml = '';
				var pending = 0;
				function finish() {
						if (feedHtml) feedList.innerHTML = feedHtml;
						if (journalHtml) journalList.innerHTML = journalHtml;
						// Highlight code blocks if highlight.js is available
						if (window.hljs) {
							document.querySelectorAll('#bookmarks-feed-list pre code, #bookmarks-feed-list code, #bookmarks-journal-list pre code, #bookmarks-journal-list code').forEach(function(block) {
								window.hljs.highlightElement(block);
							});
						}
				}
				bookmarks.forEach(function(id) {
						var isJournal = id.startsWith('journal:');
						var base = isJournal ? id.slice(8) : id;
						if (isJournal) {
								pending++;
								fetch('/data/journal/' + encodeURIComponent(base) + '.txt')
									.then(function(resp) { return resp.ok ? resp.text() : null; })
									.then(function(txt) {
										   if (txt) {
											   var lines = txt.split(/\r?\n/);
											   var date = lines[0] || '';
											   var title = lines[1] || base;
											   var desc = lines[2] || '';
											   journalHtml += '<a href="/journal/posts/' + encodeURIComponent(base) + '" class="journal-post-link" style="text-decoration:none;color:inherit;"><div id="post" style="cursor:pointer;"><span id="post-date">' + date + '</span><span id="post-title">' + title + '</span><span id="post-description">' + desc + '</span></div></a><br>';
										   }
										   // If txt is null, do not add anything (skip deleted post)
									   })
									   .catch(function() {
										   /* skip deleted post */
									   })
									.finally(function() { pending--; if (pending === 0) finish(); });
						} else {
								pending++;
								// Always append .txt for feed posts
								fetch('/data/feed/' + encodeURIComponent(base) + '.txt')
									.then(function(resp) { return resp.ok ? resp.text() : null; })
									.then(function(txt) {
										if (txt) {
											var lines = txt.split(/\r?\n/);
											var username = lines[0] || '';
											var date = lines[1] || '';
											var body = lines.slice(2).join('\n');
											// Format date as HH:MM if possible
											var dateDisplay = date;
											var timeMatch = date.match(/\b(\d{2}:\d{2})(?::\d{2})?\b/);
											if (timeMatch) {
												dateDisplay = date.replace(/\b(\d{2}:\d{2})(?::\d{2})?\b/, timeMatch[1]);
											}
											function escapeHtml(s) {
												return s.replace(/[&<>]/g, function(c) {
													return {'&':'&amp;','<':'&lt;','>':'&gt;'}[c];
												});
											}
											// Only escape &, <, > before BBCode parsing, not quotes
											// But do NOT replace newlines with <br> before BBCode parsing, let BBCode handle it
											var safeBody = escapeHtml(body);
											var htmlBody = (window.parseBBCode ? window.parseBBCode(safeBody) : safeBody);
											// Add bookmark button as in /feed
											var bookmarkIconClass = 'fa-solid'; // Always solid in bookmarks page
											var bookmarkBtn = '<span id="post-bookmark-feed" data-tooltip="save post" data-post-id="' + base + '"><i class="' + bookmarkIconClass + ' fa-bookmark"></i></span>';
											feedHtml += '<a href="/feed/posts/?=' + encodeURIComponent(base) + '" class="feed-post-link" style="text-decoration:none;color:inherit;"><div id="post" style="cursor:pointer;"><div id="post-header"><span id="post-username">' + username + '</span><span id="post-date-feed">' + dateDisplay + ' \u2022 ' + bookmarkBtn + '</span></div><span id="post-content">' + htmlBody + '</span></div></a><br>';
										}
										// If txt is null, do not add anything (skip deleted post)
										pending--; if (pending === 0) finish();
									})
									.catch(function() { pending--; if (pending === 0) finish(); });
						}
				});
				if (pending === 0) finish();
	});
}
</script>